---
title: "p8105_hw02_zy2392"
author: "Stephen Yuan"
date: "10/3/2021"
output: github_document
---

```{r load packages, echo=FALSE}
library(tidyverse)
library(readxl)
```

# Problem 1

## 1. Read in and Clean Mr.Trash Wheel data

Read in Mr.Trash Wheel data.

```{r}
raw_trash_wheel_df = read_excel("./hw_data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = 'Mr. Trash Wheel', range = 'A2:N535') %>% 
  janitor::clean_names()
```

Clean Mr.Trash Wheel data.

```{r}
trash_wheel_df = raw_trash_wheel_df %>% 
                 drop_na('dumpster') %>% 
                 rename(c('hard_plastic' = 'polystyrene')) %>%
                 mutate(sports_balls = round(sports_balls)) 
```


## 2. Read in and Clean precipitation datasets

Read and Clean preciptation data in 2018

```{r}
precipitation_2018 = 
  read_excel("./hw_data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = '2018 Precipitation', range = 'A2:B14') %>% 
  janitor::clean_names() %>% 
  drop_na(total) %>% 
  mutate(year = 2018) %>% 
  relocate(year, month, total)
```

Read and Clean preciptation data in 2019

```{r}
precipitation_2019 = 
  read_excel("./hw_data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = '2019 Precipitation', range = 'A2:B14') %>% 
  janitor::clean_names() %>% 
  drop_na(total) %>% # Transfer NaN into 0: mutate_all(~replace(., is.na(.), 0))
  mutate(year = 2019) %>% 
  relocate(year, month, total)
```

Combine precipitation data for 2018 and 2019

```{r}
prec_comb = 
  bind_rows(precipitation_2018, precipitation_2019) %>% 
  mutate(month = month.name[as.integer(month)])
```


## 3. Summary
There are `r nrow(trash_wheel_df)` observations, `r ncol(trash_wheel_df)` features in dataset Mr. Trash Wheel, key variables include `r names(trash_wheel_df)`.

*dumpster* indicates the id of trash wheel, *month* *year* *date* indicates time of dumping, *homes powered* indicates how many homes provided electricity by this project, and the remaining variables indicate differen types of trash that are collected by the wheel.

The median number of sports balls is `r median(pull(trash_wheel_df,sports_balls))`.

Dataset prec_comb indicates preciptation in 2018 and 2019, including `r nrow(prec_comb)` months in total.

The total preciptation in 2018 is `r sum(pull(precipitation_2018, total))` inches.


# Problem 2

## 1. Data manipulation for dataset pols-month.csv

Read in and Clean pols-month.csv

```{r}
raw_pols_month = read_csv("./hw_data/538_data/pols-month.csv") 

pols_month = 
  raw_pols_month %>% 
  janitor::clean_names() %>% 
  separate(., col = mon, into = c('year','month','day'), sep = '-', remove = FALSE) %>% 
  mutate(month = month.name[as.integer(month)]) %>% 
  mutate(president = ifelse(prez_gop == 1, 'gop', ifelse(prez_dem == 1, 'dem', 'others'))) %>%
  subset(., select = -c(prez_dem, prez_gop, day))
```


## 2. Data manipulation for snp.csv

```{r}
raw_snp = read_excel("./hw_data/538_data/snp.xlsx")

snp_df = 
  raw_snp %>% 
  janitor::clean_names() %>% 
  separate(col = date, into = c('month','day','year'), sep = '/', remove = FALSE) %>% 
  arrange(year, as.integer(month)) %>% 
  mutate(month = month.name[as.integer(month)]) %>%
  relocate(year, month, day)
```


## 3. Data manipulation for unemployeement.csv

```{r}
raw_unemp = read_csv("./hw_data/538_data/unemployment.csv") %>% 
  janitor::clean_names()

unemp_df = 
  raw_unemp %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "unemployment_rate"
  )
```


## 4. Merge datasets: pols_month, snp_df, unemp_df

```{r}
pols_month = 
  pols_month %>% 
  mutate(month = substr(month,1,3)) %>% 
  rename(., year_1 = year) %>% 
  rename(., month_1 = month)

snp_df = 
  snp_df %>% 
  mutate(month = substr(month,1,3)) %>%
  rename(., month_2 = month) %>% 
  rename(., year_2 = year)

semi_final_data = 
  left_join(pols_month, snp_df, by = c("year_1" = "year_2", "month_1" = "month_2")) %>% 
  mutate(year_1 = as.integer(year_1)) %>% 
  mutate(month_1 = str_to_lower(month_1))

final_data = 
  left_join(semi_final_data, unemp_df, by = c("year_1" = "year", "month_1" = "month"))
```


## 5. Summary
For pols_month.csv, it contains the comparison of political power between Democratic party and Republican party for every month.

For snp.csv, it contains closing price of stocks for every month.

For unemployment.csv, it contains the unemployment rate for every month.

For the final dataset, there are `r nrow(final_data)` observations and `r ncol(final_data)` features. It ranges from `r min(pull(final_data,mon))` to `r max(pull(final_data, mon))`,  `r round((max(pull(final_data,mon)) - min(pull(final_data, mon))) / 365, 0)` years in total. In addition, variable *mon* refers to date of event, *gov*, *sen*, *rep* represent the political comparison between Democratic party and Republican party, *close* refers to closing price of stock, and *unemployment_rate* associats with the unemployment rate on specific day.

# Problem 3

## 1. Read in and Tidy data

```{r}
raw_pop_names = 
  read_csv("./hw_data/Popular_Baby_Names.csv") %>% 
  janitor::clean_names()
```

```{r}
# 'ASIAN AND PACIFIC ISLANDER' and 'ASIAN AND PACI' refer to the same thing
# 'BLACK NON HISPANIC', 'BLACK NON HISP' refer to the same thing
# 'WHITE NON HISPANIC', 'WHITE NON HISP' refer to the same thing
# case structure of childs_first_name changed over time
pop_names = 
  raw_pop_names %>% 
  distinct(year_of_birth, gender, ethnicity, childs_first_name, count, rank) %>% 
  mutate(childs_first_name = str_to_lower(childs_first_name)) %>% 
  mutate(ethnicity = ifelse(ethnicity == 'ASIAN AND PACI', 'ASIAN AND PACIFIC ISLANDER', 
                              ifelse(ethnicity == 'BLACK NON HISP', 'BLACK NON HISPANIC',
                                     ifelse(ethnicity == 'WHITE NON HISP', 'WHITE NON HISPANIC', ethnicity))))
head(pop_names, 10) %>% 
  knitr::kable()
```


## 2. Find the popularity of specific names

Showing the rank in popularity of the name “Olivia”.

```{r}
pop_olivia = 
  pop_names %>% 
  select(-count) %>% 
  filter(gender == 'FEMALE' & childs_first_name == 'olivia') %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "rank"
  ) %>% 
  select (-gender, -childs_first_name)

pop_olivia %>% 
  knitr::kable()
```

Showing the most popular name among male children over time (by year).

count the number of name of male children by year.

```{r}
pop_male_name = 
  pop_names %>% 
  filter(gender == "MALE") %>% 
  group_by(year_of_birth, ethnicity, childs_first_name) %>% 
  summarise(count_name = sum(count)) %>% 
  filter(count_name == max(count_name))
```

make table to show most popular male name each year.

```{r}
pop_male_name_by_year = 
    pop_male_name %>% 
  select(-count_name) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "childs_first_name"
  )

pop_male_name_by_year %>% 
  knitr::kable()
```


## 3. Scatterplot: the number of children with a name (y) v.s. the rank in popularity of name (x).

```{r, fig.width=9, fig.height=80}
name_rank_plot = 
  pop_names %>% 
  filter(gender == "MALE" & ethnicity == "WHITE NON HISPANIC" & year_of_birth == 2016) %>% 
  mutate(childs_first_name = as.factor(childs_first_name))

ggplot(name_rank_plot, aes(x = rank, y = childs_first_name)) + geom_point()
```





